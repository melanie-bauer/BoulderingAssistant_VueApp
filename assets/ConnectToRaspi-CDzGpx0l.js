import{_ as I}from "./HomeButton-Cv_qRuF6.js";import{_ as b,r as f,f as T,g as F,h as k,i as M,o as d,c as l,b as R,F as j,j as D,n as E,k as B,p as W,e as X,a as H}from "./index-CGpix6fV.js";const Y= c=>(W("data-v-329e904b"),c=c(),X(),c),K={id:"container"},O=Y(()=>R("video",{id:"video",autoplay:"",style:{display:"none"}},null,-1)),N=["id","onMousedown","onTouchstart"],S=20,L=60,P={__name:"Canvas",setup(c){const o=f(null),s=f(!1),u=f(null),h=T({x:0,y:0}),a=T({Head:{id:"Head",x:160,y:120}}),C=F(()=>{const e=["Head","item"];return Object.fromEntries(Object.entries(a).filter(([t])=>!e.includes(t)))}),i=f();let g;async function _(){try{const t=await(await fetch("http://localhost:3000/points")).json();Object.assign(a,t.reduce((n, r)=>(n[r.id]=r,n),{})),x(a)}catch(e){console.error("Error fetching data:",e)}}function x(e){const t=o.value.getContext("2d");t.lineWidth=5,t&&(t.clearRect(0,0,o.value.width,o.value.height),t.drawImage(i.value,0,0,o.value.width,o.value.height),t.beginPath(),t.moveTo(e.Shoulders.x,e.Shoulders.y),t.lineTo(e.Hip.x,e.Hip.y),t.lineTo(e.LK.x,e.LK.y),t.lineTo(e.LF.x,e.LF.y),t.moveTo(e.Hip.x,e.Hip.y),t.lineTo(e.RK.x,e.RK.y),t.lineTo(e.RF.x,e.RF.y),t.moveTo(e.Shoulders.x,e.Shoulders.y),t.lineTo(e.LE.x,e.LE.y),t.lineTo(e.LH.x,e.LH.y),t.moveTo(e.Shoulders.x,e.Shoulders.y),t.lineTo(e.RE.x,e.RE.y),t.lineTo(e.RH.x,e.RH.y),t.moveTo(e.Shoulders.x,e.Shoulders.y),t.lineTo(e.Head.x,e.Head.y),t.strokeStyle="white",t.stroke())}function v(e, t){s.value=!0,u.value=t;const n=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX,r=e.type.startsWith("touch")?e.touches[0].clientY:e.clientY;h.x=n-a[t].x,h.y=r-a[t].y,e.type==="mousedown"?(document.addEventListener("mousemove",m),document.addEventListener("mouseup",y)):e.type==="touchstart"&&(document.addEventListener("touchmove",m),document.addEventListener("touchend",y))}function m(e){if(!s.value)return;const t=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX,n=e.type.startsWith("touch")?e.touches[0].clientY:e.clientY;a[u.value].x=t-h.x,a[u.value].y=n-h.y,x(a)}async function y(){s.value=!1,document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",y),document.removeEventListener("touchmove",m),document.removeEventListener("touchend",y);const e=u.value;try{(await fetch(`http://localhost:3000/points/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(a[e])})).ok||console.error("Failed to update points")}catch(t){console.error("Error updating points:",t)}}k(()=>{o.value=document.getElementById("canvas"),i.value=document.getElementById("video"),_(),setInterval(_,1e3),o.value.width=window.innerWidth,o.value.height=window.innerHeight,navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"}},audio:!1}).then(function(e){g=e,i.value.srcObject=e,i.value.play(),w()}).catch(function(e){console.error("Error accessing media devices.",e)}):console.error("getUserMedia not supported in this browser.")});const w=()=>{o.value.getContext("2d").drawImage(i.value,0,0,o.value.width,o.value.height),x(a),requestAnimationFrame(w)};return M(()=>{g&&g.getTracks().forEach(e=>{e.stop()})}),(e, t)=>(d(),l("div",K,[O,R("canvas",{id:"canvas",ref_key:"canvas",ref:o},null,512),(d(!0),l(j,null,D(C.value,(n, r)=>(d(),l("div",{id:r,key:r,style:E({top:n.y-S/2+"px",left:n.x-S/2+"px"}),class:"point",draggable:"true",onMousedown: p=>v(p,r),onTouchstart: p=>v(p,r)},null,44,N))),128)),a?(d(),l("div",{key:0,id:"Head",style:E({top:a.Head.y-L/2+"px",left:a.Head.x-L/2+"px"}),class:"head",draggable:"true",onMousedown:t[0]||(t[0]= n=>v(n,"Head")),onTouchstart:t[1]||(t[1]= n=>v(n,"Head"))},null,36)):B("",!0)]))}},U=b(P,[["__scopeId","data-v-329e904b"]]),V={class:"container"},$={__name:"ConnectToRaspi",setup(c){return(o, s)=>(d(),l("div",V,[H(U),H(I,{onClick:s[0]||(s[0]=()=>{})})]))}},q=b($,[["__scopeId","data-v-4effc19a"]]);export{q as default};
