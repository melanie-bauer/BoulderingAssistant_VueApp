import{e as O,_ as $}from "./BoulderingSession-Dpn6jeKI.js";import{r as x,_ as D,a as P,c as X,w as q,o as V,b as W,d as H,e as g,f as T,F as Y,g as z,n as B,h as F,p as A,i as G,t as J,u as Z,j as K,k as U,l as j,P as C,m as I}from "./index-KLhVc_n2.js";const Q="/deploy-vue-vite-app/assets/rotate-left-CxPc4Vuv.png";function ee(d){return{all:d=d||new Map,on:function(r, a){var o=d.get(r);o?o.push(a):d.set(r,[a])},off:function(r, a){var o=d.get(r);o&&(a?o.splice(o.indexOf(a)>>>0,1):d.set(r,[]))},emit:function(r, a){var o=d.get(r);o&&o.slice().map(function(m){m(a)}),(o=d.get("*"))&&o.slice().map(function(m){m(r,a)})}}}const N=ee(),te= d=>(A("data-v-0c9e6d53"),d=d(),G(),d),ae={id:"container"},oe=te(()=>T("video",{id:"video",autoplay:"",style:{display:"none"}},null,-1)),ne=["id","onMousedown","onTouchstart"],f=x(["Head","Shoulders","Hip","LE","RE","LK","RK","LF","RF","LH","RH"]),se={__name:"Canvas",props:{showFixedPositionButton:{type:Boolean,required:!0}},setup(d){const r=d,a=x(null),o=x(!1),m=x(null),w=P({x:0,y:0}),S=20,M=60,u=P({Head:{id:"Head",x:160,y:120}}),R=x(),k=X(()=>{const e=["Head","item"];return Object.fromEntries(Object.entries(u).filter(([t])=>!e.includes(t)))}),E=x(!1),n=x();let s;q(()=>r.showFixedPositionButton, e=>{e?f.value=["Head","Shoulders","Hip","LE","RE","LK","RK","LF","RF","LH","RH"]:f.value=["Head","Shoulders","Hip"]});function l(e){switch(e){case"LE":case"LH":return["LE","LH","Head","Shoulders","Hip"];case"RE":case"RH":return["RE","RH","Head","Shoulders","Hip"];case"LK":case"LF":return["LK","LF","Head","Shoulders","Hip"];case"RK":case"RF":return["RK","RF","Head","Shoulders","Hip"];default:return[]}}async function i(){try{const t=await(await fetch("http://localhost:3000/points")).json();o.value||(Object.assign(u,t.reduce((h, p)=>(h[p.id]=p,h),{})),v(u),E.value=!0)}catch(e){console.error("Error fetching data:",e)}}function v(e){const t=a.value.getContext("2d");t.lineWidth=5,t&&(t.clearRect(0,0,a.value.width,a.value.height),t.drawImage(n.value,0,0,a.value.width,a.value.height),t.beginPath(),e.Shoulders&&e.Hip&&(t.moveTo(e.Shoulders.x,e.Shoulders.y),t.lineTo(e.Hip.x,e.Hip.y)),e.LK&&e.LF&&(t.lineTo(e.LK.x,e.LK.y),t.lineTo(e.LF.x,e.LF.y)),e.RK&&e.RF&&(t.moveTo(e.Hip.x,e.Hip.y),t.lineTo(e.RK.x,e.RK.y),t.lineTo(e.RF.x,e.RF.y)),e.LE&&e.LH&&(t.moveTo(e.Shoulders.x,e.Shoulders.y),t.lineTo(e.LE.x,e.LE.y),t.lineTo(e.LH.x,e.LH.y)),e.RE&&e.RH&&(t.moveTo(e.Shoulders.x,e.Shoulders.y),t.lineTo(e.RE.x,e.RE.y),t.lineTo(e.RH.x,e.RH.y)),e.Head&&(t.moveTo(e.Shoulders.x,e.Shoulders.y),t.lineTo(e.Head.x,e.Head.y)),t.strokeStyle="white",t.stroke())}function L(e, t){if(!r.showFixedPositionButton&&f.value.length===3&&["LE","LH","RE","RH","LK","LF","RK","RF"].includes(t)&&(f.value=l(t)),f.value.map(p=>p).includes(t)){o.value=!0,m.value=t;const p=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX,_=e.type.startsWith("touch")?e.touches[0].clientY:e.clientY;w.x=p-u[t].x,w.y=_-u[t].y,e.type==="mousedown"?(document.addEventListener("mousemove",c),document.addEventListener("mouseup",y)):e.type==="touchstart"&&(document.addEventListener("touchmove",c),document.addEventListener("touchend",y))}}function c(e){if(!o.value)return;const t=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX,h=e.type.startsWith("touch")?e.touches[0].clientY:e.clientY;u[m.value].x=t-w.x,u[m.value].y=h-w.y,v(u)}async function y(){o.value=!1,document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",y),document.removeEventListener("touchmove",c),document.removeEventListener("touchend",y);const e=m.value;try{const t=await fetch(`http://localhost:3000/points/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(u[e])})}catch(t){console.error("Error updating points:",t)}}V(()=>{a.value=document.getElementById("canvas"),n.value=document.getElementById("video"),i(),R.value=setInterval(i,3e3),N.on("reset-draggable-limbs",async e=>{for(let t in f.value)try{const h=await fetch(`http://localhost:3000/points/${f.value[t]}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e[f.value[t]])})}catch(h){console.error("Error updating points:",h)}f.value=["Head","Shoulders","Hip"],await i()}),a.value.width=window.innerWidth,a.value.height=window.innerHeight,navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"}},audio:!1}).then(e=>{s=e,n.value.srcObject=e,n.value.play(),b()}).catch(e=>{console.error("Error accessing media devices.",e)}):console.error("getUserMedia not supported in this browser.")}),W(()=>{s&&s.getTracks().forEach(e=>{e.stop()}),R.value&&clearInterval(R.value)});function b(){a.value.getContext("2d").drawImage(n.value,0,0,a.value.width,a.value.height),u&&Object.keys(u).length>1&&v(u),requestAnimationFrame(b)}return(e, t)=>(H(),g("div",ae,[oe,T("canvas",{id:"canvas",ref_key:"canvas",ref:a},null,512),(H(!0),g(Y,null,z(k.value,(h, p)=>(H(),g("div",{id:p,key:p,style:B({top:h.y-S/2+"px",left:h.x-S/2+"px"}),class:"point",draggable:"true",onMousedown: _=>L(_,p),onTouchstart: _=>L(_,p)},null,44,ne))),128)),E.value?(H(),g("div",{key:0,id:"Head",style:B({top:u.Head.y-M/2+"px",left:u.Head.x-M/2+"px"}),class:"head",draggable:!0,onMousedown:t[0]||(t[0]= h=>L(h,"Head")),onTouchstart:t[1]||(t[1]= h=>L(h,"Head"))},null,36)):F("",!0)]))}},re=D(se,[["__scopeId","data-v-0c9e6d53"]]),ie={class:"container d-flex flex-column justify-content-between"},ce={id:"timer",class:"overlay"},le={class:"text-center row d-flex justify-content-center align-items-center padding"},ue={key:0,width:"20px",height:"20px",src:Q,alt:"left rotating circle"},de={__name:"GetNextHandle",setup(d){const r=x(!0),a=x({}),o=x({}),m=x();async function w(){r.value=!r.value;try{const s=await(await fetch("http://localhost:3000/points")).json();Object.assign(a,s.reduce((l, i)=>(l[i.id]=i,l),{}))}catch(n){console.error("Error fetching data:",n)}}function S(){N.emit("reset-draggable-limbs",a)}async function M(){try{const s=await(await fetch("http://localhost:3000/personHeight")).json();m.value=s[0].value}catch(n){console.error("Error fetching data:",n)}try{const s=await(await fetch("http://localhost:3000/points")).json();Object.assign(o,s.reduce((i, v)=>(i[v.id]=v,i),{})),console.log(f);let l=f.value.map(i=>i);l.length>3&&m.value>0&&(r.value=!r.value,u(l[1]),f.value=["Head","Shoulder","Hip"])}catch(n){console.error("Error fetching data:",n)}}function u(n){let s="Bitte bewege deine";switch(n){case"LH":s+="linke Hand ";break;case"RH":s+="rechte Hand ";break;case"LF":s+="n linken Fuß ";break;case"RF":s+="n rechten Fuß ";break}s+=`${R(E(n))} Zentimeter nach ${k(n)}`;let l=new SpeechSynthesisUtterance(s);window.speechSynthesis.speak(l)}function R(n){const s=Math.floor(n/5)*5,l=s+5;return n-s<l-n?s:l}function k(n){const s=[{min:345,max:15,time:"12 Uhr"},{min:15,max:45,time:"1 Uhr"},{min:45,max:75,time:"2 Uhr"},{min:75,max:105,time:"3 Uhr"},{min:105,max:135,time:"4 Uhr"},{min:135,max:165,time:"5 Uhr"},{min:165,max:195,time:"6 Uhr"},{min:195,max:225,time:"7 Uhr"},{min:225,max:255,time:"8 Uhr"},{min:255,max:285,time:"9 Uhr"},{min:285,max:315,time:"10 Uhr"},{min:315,max:345,time:"11 Uhr"}],l=a[n],i=o[n],v=i.x-l.x,L=i.y-l.y;let c=Math.atan2(L,v)*(180/Math.PI);c<0&&c>=-90?c=90+c:c<-90?c=450+c:c=90+c;let y;return c>=345||c<15?y=s[0]:y=s.find(b=>c>=b.min&&c<b.max),y?y.time:""}function E(n){let s=Math.sqrt(Math.pow(Math.abs(o.Hip.x-o.Shoulders.x),2)+Math.pow(Math.abs(o.Hip.y-o.Shoulders.y),2)),l=m.value/2-m.value/7,i;switch(n){case"LH":i=Math.sqrt(Math.pow(Math.abs(a.LH.x-o.LH.x),2)+Math.pow(Math.abs(a.LH.y-o.LH.y),2));break;case"RH":i=Math.sqrt(Math.pow(Math.abs(a.RH.x-o.RH.x),2)+Math.pow(Math.abs(a.RH.y-o.RH.y),2));break;case"LF":i=Math.sqrt(Math.pow(Math.abs(a.LF.x-o.LF.x),2)+Math.pow(Math.abs(a.LF.y-o.LF.y),2));break;case"RF":i=Math.sqrt(Math.pow(Math.abs(a.RF.x-o.RF.x),2)+Math.pow(Math.abs(a.RF.y-o.RF.y),2));break}let v=i*l/s;return console.log(v),v}return(n, s)=>(H(),g("div",ie,[T("p",ce,J(Z(O)),1),K(re,{"show-fixed-position-button":r.value},null,8,["show-fixed-position-button"]),K($),T("div",le,[r.value?(H(),U(C,{key:0,id:"confirmStickman",class:"overlay",fontSize:"24px",to:"/connectRaspi",width:"90%",onClick:w},{default:j(()=>[I(" confirm Stickman-Position ")]),_:1})):F("",!0),r.value?F("",!0):(H(),g("button",{key:1,type:"button",id:"reverseButton",class:"btn btn-primary overlay mx-1",onClick:S},[r.value?F("",!0):(H(),g("img",ue))])),r.value?F("",!0):(H(),U(C,{key:2,id:"confirmNextHandle",class:"overlay mx-1",fontSize:"22px",to:"/connectRaspi",width:"80%",onClick:M},{default:j(()=>[I(" confirm next Handl-Position ")]),_:1}))])]))}},fe=D(de,[["__scopeId","data-v-9341f7c3"]]);export{fe as default};
