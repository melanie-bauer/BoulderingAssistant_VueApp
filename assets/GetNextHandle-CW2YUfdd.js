import{s as q,a as V,e as P,_ as W}from "./BoulderingSession-CZAU2Dvu.js";import{r as x,_ as O,a as j,c as Y,w as z,o as $,b as A,d as y,e as H,f as k,F as G,g as J,n as B,h as F,p as Z,i as Q,u as K,t as ee,j as U,k as C,l as I,P as D,m as N}from "./index-DD202vR9.js";const te="/deploy-vue-vite-app/assets/rotate-left-CxPc4Vuv.png";function ae(d){return{all:d=d||new Map,on:function(r, a){var o=d.get(r);o?o.push(a):d.set(r,[a])},off:function(r, a){var o=d.get(r);o&&(a?o.splice(o.indexOf(a)>>>0,1):d.set(r,[]))},emit:function(r, a){var o=d.get(r);o&&o.slice().map(function(m){m(a)}),(o=d.get("*"))&&o.slice().map(function(m){m(r,a)})}}}const X=ae(),oe= d=>(Z("data-v-0c9e6d53"),d=d(),Q(),d),ne={id:"container"},se=oe(()=>k("video",{id:"video",autoplay:"",style:{display:"none"}},null,-1)),re=["id","onMousedown","onTouchstart"],v=x(["Head","Shoulders","Hip","LE","RE","LK","RK","LF","RF","LH","RH"]),ie={__name:"Canvas",props:{showFixedPositionButton:{type:Boolean,required:!0}},setup(d){const r=d,a=x(null),o=x(!1),m=x(null),w=j({x:0,y:0}),S=20,E=60,u=j({Head:{id:"Head",x:160,y:120}}),b=x(),T=Y(()=>{const e=["Head","item"];return Object.fromEntries(Object.entries(u).filter(([t])=>!e.includes(t)))}),M=x(!1),n=x();let s;z(()=>r.showFixedPositionButton, e=>{e?v.value=["Head","Shoulders","Hip","LE","RE","LK","RK","LF","RF","LH","RH"]:v.value=["Head","Shoulders","Hip"]});function l(e){switch(e){case"LE":case"LH":return["LE","LH","Head","Shoulders","Hip"];case"RE":case"RH":return["RE","RH","Head","Shoulders","Hip"];case"LK":case"LF":return["LK","LF","Head","Shoulders","Hip"];case"RK":case"RF":return["RK","RF","Head","Shoulders","Hip"];default:return[]}}async function i(){try{const t=await(await fetch("http://localhost:3000/points")).json();o.value||(Object.assign(u,t.reduce((h, p)=>(h[p.id]=p,h),{})),f(u),M.value=!0)}catch(e){console.error("Error fetching data:",e)}}function f(e){const t=a.value.getContext("2d");t.lineWidth=5,t&&(t.clearRect(0,0,a.value.width,a.value.height),t.drawImage(n.value,0,0,a.value.width,a.value.height),t.beginPath(),e.Shoulders&&e.Hip&&(t.moveTo(e.Shoulders.x,e.Shoulders.y),t.lineTo(e.Hip.x,e.Hip.y)),e.LK&&e.LF&&(t.lineTo(e.LK.x,e.LK.y),t.lineTo(e.LF.x,e.LF.y)),e.RK&&e.RF&&(t.moveTo(e.Hip.x,e.Hip.y),t.lineTo(e.RK.x,e.RK.y),t.lineTo(e.RF.x,e.RF.y)),e.LE&&e.LH&&(t.moveTo(e.Shoulders.x,e.Shoulders.y),t.lineTo(e.LE.x,e.LE.y),t.lineTo(e.LH.x,e.LH.y)),e.RE&&e.RH&&(t.moveTo(e.Shoulders.x,e.Shoulders.y),t.lineTo(e.RE.x,e.RE.y),t.lineTo(e.RH.x,e.RH.y)),e.Head&&(t.moveTo(e.Shoulders.x,e.Shoulders.y),t.lineTo(e.Head.x,e.Head.y)),t.strokeStyle="white",t.stroke())}function L(e, t){if(!r.showFixedPositionButton&&v.value.length===3&&["LE","LH","RE","RH","LK","LF","RK","RF"].includes(t)&&(v.value=l(t)),v.value.map(p=>p).includes(t)){o.value=!0,m.value=t;const p=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX,_=e.type.startsWith("touch")?e.touches[0].clientY:e.clientY;w.x=p-u[t].x,w.y=_-u[t].y,e.type==="mousedown"?(document.addEventListener("mousemove",c),document.addEventListener("mouseup",g)):e.type==="touchstart"&&(document.addEventListener("touchmove",c),document.addEventListener("touchend",g))}}function c(e){if(!o.value)return;const t=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX,h=e.type.startsWith("touch")?e.touches[0].clientY:e.clientY;u[m.value].x=t-w.x,u[m.value].y=h-w.y,f(u)}async function g(){o.value=!1,document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",g),document.removeEventListener("touchmove",c),document.removeEventListener("touchend",g);const e=m.value;try{const t=await fetch(`http://localhost:3000/points/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(u[e])})}catch(t){console.error("Error updating points:",t)}}$(()=>{a.value=document.getElementById("canvas"),n.value=document.getElementById("video"),i(),b.value=setInterval(i,3e3),X.on("reset-draggable-limbs",async e=>{for(let t in v.value)try{const h=await fetch(`http://localhost:3000/points/${v.value[t]}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e[v.value[t]])})}catch(h){console.error("Error updating points:",h)}v.value=["Head","Shoulders","Hip"],await i()}),a.value.width=window.innerWidth,a.value.height=window.innerHeight,navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"}},audio:!1}).then(e=>{s=e,n.value.srcObject=e,n.value.play(),R()}).catch(e=>{console.error("Error accessing media devices.",e)}):console.error("getUserMedia not supported in this browser.")}),A(()=>{s&&s.getTracks().forEach(e=>{e.stop()}),b.value&&clearInterval(b.value)});function R(){a.value.getContext("2d").drawImage(n.value,0,0,a.value.width,a.value.height),u&&Object.keys(u).length>1&&f(u),requestAnimationFrame(R)}return(e, t)=>(y(),H("div",ne,[se,k("canvas",{id:"canvas",ref_key:"canvas",ref:a},null,512),(y(!0),H(G,null,J(T.value,(h, p)=>(y(),H("div",{id:p,key:p,style:B({top:h.y-S/2+"px",left:h.x-S/2+"px"}),class:"point",draggable:"true",onMousedown: _=>L(_,p),onTouchstart: _=>L(_,p)},null,44,re))),128)),M.value?(y(),H("div",{key:0,id:"Head",style:B({top:u.Head.y-E/2+"px",left:u.Head.x-E/2+"px"}),class:"head",draggable:!0,onMousedown:t[0]||(t[0]= h=>L(h,"Head")),onTouchstart:t[1]||(t[1]= h=>L(h,"Head"))},null,36)):F("",!0)]))}},ce=O(ie,[["__scopeId","data-v-0c9e6d53"]]),le={class:"container d-flex flex-column justify-content-between"},ue={key:0,class:"overlay timer"},de={key:1,class:"overlay timer"},he={class:"text-center row d-flex justify-content-center align-items-center padding"},me={key:0,width:"20px",height:"20px",src:te,alt:"left rotating circle"},ve={__name:"GetNextHandle",setup(d){const r=x(!0),a=x({}),o=x({}),m=x();async function w(){r.value=!r.value;try{const s=await(await fetch("http://localhost:3000/points")).json();Object.assign(a,s.reduce((l, i)=>(l[i.id]=i,l),{}))}catch(n){console.error("Error fetching data:",n)}}function S(){X.emit("reset-draggable-limbs",a)}async function E(){try{const s=await(await fetch("http://localhost:3000/personHeight")).json();m.value=s[0].value}catch(n){console.error("Error fetching data:",n)}try{const s=await(await fetch("http://localhost:3000/points")).json();Object.assign(o,s.reduce((i, f)=>(i[f.id]=f,i),{})),console.log(v);let l=v.value.map(i=>i);l.length>3&&m.value>0&&(r.value=!r.value,u(l[1]),v.value=["Head","Shoulder","Hip"])}catch(n){console.error("Error fetching data:",n)}}function u(n){let s="Bitte bewege deine";switch(n){case"LH":s+="linke Hand ";break;case"RH":s+="rechte Hand ";break;case"LF":s+="n linken Fuß ";break;case"RF":s+="n rechten Fuß ";break}s+=`${b(M(n))} Zentimeter nach ${T(n)}`;let l=new SpeechSynthesisUtterance(s);window.speechSynthesis.speak(l)}function b(n){const s=Math.floor(n/5)*5,l=s+5;return n-s<l-n?s:l}function T(n){const s=[{min:345,max:15,time:"12 Uhr"},{min:15,max:45,time:"1 Uhr"},{min:45,max:75,time:"2 Uhr"},{min:75,max:105,time:"3 Uhr"},{min:105,max:135,time:"4 Uhr"},{min:135,max:165,time:"5 Uhr"},{min:165,max:195,time:"6 Uhr"},{min:195,max:225,time:"7 Uhr"},{min:225,max:255,time:"8 Uhr"},{min:255,max:285,time:"9 Uhr"},{min:285,max:315,time:"10 Uhr"},{min:315,max:345,time:"11 Uhr"}],l=a[n],i=o[n],f=i.x-l.x,L=i.y-l.y;let c=Math.atan2(L,f)*(180/Math.PI);c<0&&c>=-90?c=90+c:c<-90?c=450+c:c=90+c;let g;return c>=345||c<15?g=s[0]:g=s.find(R=>c>=R.min&&c<R.max),g?g.time:""}function M(n){let s=Math.sqrt(Math.pow(Math.abs(o.Hip.x-o.Shoulders.x),2)+Math.pow(Math.abs(o.Hip.y-o.Shoulders.y),2)),l=m.value/2-m.value/7,i;switch(n){case"LH":i=Math.sqrt(Math.pow(Math.abs(a.LH.x-o.LH.x),2)+Math.pow(Math.abs(a.LH.y-o.LH.y),2));break;case"RH":i=Math.sqrt(Math.pow(Math.abs(a.RH.x-o.RH.x),2)+Math.pow(Math.abs(a.RH.y-o.RH.y),2));break;case"LF":i=Math.sqrt(Math.pow(Math.abs(a.LF.x-o.LF.x),2)+Math.pow(Math.abs(a.LF.y-o.LF.y),2));break;case"RF":i=Math.sqrt(Math.pow(Math.abs(a.RF.x-o.RF.x),2)+Math.pow(Math.abs(a.RF.y-o.RF.y),2));break}let f=i*l/s;return console.log(f),f}return $(async()=>{try{const s=await(await fetch("http://localhost:3000/startTime/startTime")).json();q.value=s.value,await V()}catch(n){console.error("Error updating personHeight:",n)}}),(n, s)=>(y(),H("div",le,[K(P)?(y(),H("p",ue,ee(K(P)),1)):(y(),H("p",de,"00:00")),U(ce,{"show-fixed-position-button":r.value},null,8,["show-fixed-position-button"]),U(W,{to:"/overview","img-src":"/deploy-vue-vite-app/src/assets/images/back-arrow.png","top-distance":"27px"}),k("div",he,[r.value?(y(),C(D,{key:0,id:"confirmStickman",class:"overlay",fontSize:"24px",to:"/connectRaspi",width:"90%",onClick:w},{default:I(()=>[N(" confirm Stickman-Position ")]),_:1})):F("",!0),r.value?F("",!0):(y(),H("button",{key:1,type:"button",id:"reverseButton",class:"btn btn-primary overlay mx-1",onClick:S},[r.value?F("",!0):(y(),H("img",me))])),r.value?F("",!0):(y(),C(D,{key:2,id:"confirmNextHandle",class:"overlay mx-1",fontSize:"22px",to:"/connectRaspi",width:"80%",onClick:E},{default:I(()=>[N(" confirm next Handl-Position ")]),_:1}))])]))}},ye=O(ve,[["__scopeId","data-v-008bf76e"]]);export{ye as default};
